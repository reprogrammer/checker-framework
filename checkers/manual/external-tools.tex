\htmlhr
\chapter{Integration with external tools\label{external-tools}}

This section discusses how to run a checker from your favorite IDE\@.

Or, if your favorite isn't here, you should customize how it runs the
javac command on your behalf.  See the IDE documentation to learn how to
customize it, adapting the instructions for javac in Section~\ref{running}.
If you make another tool support running a checker, please 
inform us via the
\ahref{http://groups.google.com/group/checker-framework-discuss}{mailing
  list} or
\ahref{http://code.google.com/p/checker-framework/issues/list}{issue tracker} so
we can add it to this manual.

This section also discusses type inference tools (see
Section~\ref{type-inference-tools}).


\section{Ant task\label{ant-task}}

If you use the \ahref{http://ant.apache.org/}{Ant} build tool to compile
your software, then you can add an Ant task that runs a checker.  We assume
that your Ant file already contains a compilation target that uses the
\code{javac} task.

First, set the \code{jsr308javac} property:

%BEGIN LATEX
\begin{smaller}
%END LATEX
\begin{Verbatim}
  <!-- Boilerplate to set jsr308javac property. Is there a better way? -->
  <property environment="env"/>
  <condition property="isUnix">
    <os family="unix" />
  </condition>
  <condition property="isWindows">
    <os family="windows" />
  </condition>
  <target name="init-jsr308javac-unix" if="isUnix">
    <property name="jsr308javac" value="${env.CHECKERS}/binary/javac" />
  </target>
  <target name="init-jsr308javac-windows" if="isWindows">
    <property name="jsr308javac" value="${env.CHECKERS}/binary/javac.bat" />
  </target>
\end{Verbatim}
%BEGIN LATEX
\end{smaller}
%END LATEX

\noindent
The \code{property} target makes environment variables (such as your home
directory) available to Ant.

Next, duplicate the compilation target, then modify it slightly as
indicated in this example, filling in each ellipsis (\ldots) from the
original compilation target:

%BEGIN LATEX
\begin{smaller}
%END LATEX
\begin{Verbatim}
  <target name="check-nullness"
          description="Check for nullness errors."
          depends="clean,...,init-jsr308javac-unix,init-jsr308javac-windows">
    <javac ...
           fork="yes"
           executable="${jsr308javac}">
      <compilerarg value="-version"/>
      <compilerarg line="-target 5"/>
      <compilerarg line="-processor checkers.nullness.NullnessChecker"/>
      <compilerarg line="-Xbootclasspath/p:${env.CHECKERS}/jdk/nullness/jdk.jar"/>
      <compilerarg value="-implicit:class"/>
      <classpath>
        <pathelement location="${env.annotations}/checkers/checkers.jar"/>
        ...
      </classpath>
      ...
    </javac>
  </target>
\end{Verbatim}
%BEGIN LATEX
\end{smaller}
%END LATEX

In the example, the target is named \code{check-nullness}, but you can
name it whatever you like.

The target assumes the existence of a \code{clean} target that removes all
\code{.class} files.  That is necessary because Ant's \code{javac} target
doesn't re-compile \code{.java} files for which a \code{.class} file
already exists.

The \code{executable} and \code{fork} fields of the \code{javac} task
ensure that an external javac program is called.  Otherwise, Ant will run
javac via a Java method call, and there is no guarantee that it will get
the JSR 308 version that is distributed with the Checker Framework.

The \code{-version} compiler argument is just for debugging; you may omit
it.

The \code{-target 5} compiler argument is optional, if you use Java 5 in
ordinary compilation when not performing pluggable type-checking.

The \code{-processor ...} compiler argument indicates which checker to
run.  You can supply additional arguments to the checker as well.

The \code{-implicit:class} compiler argument causes annotation processing
to be performed on implicitly compiled files.  (An implicitly compiled file
is one that was not specified on the command line, but for which the source
code is newer than the \code{.class} file.)  This is the default, but
supplying the argument explicitly suppresses a compiler warning.


\section{Maven plugin\label{maven-plugin}}

Adam Warski has written a Maven2 plugin that runs a checker.
The plugin is available at 
\myurl{http://www.warski.org/checkersplugin.html}.


\section{IntelliJ IDEA\label{intellij}}

IntelliJ IDEA (Maia release)
\ahref{http://blogs.jetbrains.com/idea/2009/07/type-annotations-jsr-308-support/}{supports}
the Type Annotations (JSR-308) syntax.
See \url{http://blogs.jetbrains.com/idea/2009/07/type-annotations-jsr-308-support/}.

\section{Eclipse\label{eclipse}}

There are two ways to run a checker from within the Eclipse IDE:  via Ant
or using an Eclipse plug-in.


\paragraph{Using an Ant task}

Add an Ant target as described in Section~\ref{ant-task}.  You can
run the Ant target by executing the following steps
(instructions copied from
\myurl{http://www.eclipse.org/documentation/?topic=/org.eclipse.platform.doc.user/gettingStarted/qs-84_run_ant.htm}):

\begin{enumerate}

\item
  Select \code{build.xml} in one of the navigation views and choose
  {\bf Run As $>$ Ant Build...} from its context menu.

\item
  A launch configuration dialog is opened on a launch configuration
  for this Ant buildfile.

\item
  In the {\bf Targets} tab, select the new ant task (e.g., check-interning).

\item
  Click {\bf Run}.

\item
  The Ant buildfile is run, and the output is sent to the Console view.

\end{enumerate}

\paragraph{Eclipse plug-in}

There are two choices for Eclipse support for type annotations.

A prototype Eclipse plug-in for running a checker is available at
\myurl{http://types.cs.washington.edu/checker-framework/eclipse/}.  
The website contains instructions for installing and using the plug-in.
The plug-in is
experimental now, but some people have used it successfully (and we have fixed
all bugs that have been reported so far).

Another prototype version of Type Annotations support for Eclipse is
available from the Eclipse project.  Use the following information to check
out the CVS repository:
\begin{description}
\item[Host:]                 dev.eclipse.org
\item[Repository path:] /cvsroot/eclipse
\item[Module name:]    org.eclipse.jdt.core
\item[Branch:]             JSR\_308
\end{description}


\section{tIDE\label{tide}}

tIDE, an open-source Java IDE, supports the Checker Framework.  See its
documentation at \myurl{http://tide.olympe-network.com/}.


\section{Type inference tools\label{type-inference-tools}}

Section~\ref{nullness-inference} lists several tools that infer
annotations for the Nullness Checker.

Section~\ref{javari-inference} lists a tool that infers
annotations for the Javari Checker, which detects mutation errors.


% LocalWords:  jsr plugin Warski xml buildfile tIDE
