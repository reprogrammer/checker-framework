\htmlhr
\chapter{Signature checker for string representations of types\label{signature-checker}}

The Signature String Checker, or Signature Checker for short, verifies that
string representations of types and signatures are used correctly.

Java defines multiple different string representations for a type, and it is easy to
misuse them or to miss bugs during testing.  Using the wrong string format
leads to a run-time exception or an incorrect result.  This is a particular
problem for fully qualified and binary names, which are nearly the same ---
they differ only for nested classes and arrays.


\section{Signature annotations\label{signature-annotations}}

Java defines three main formats for the string representation of a type.
There is an annotation for each of these representations, plus one more.
Figure~\ref{fig:signature-hierarchy} shows how they are related.

\begin{figure}
\includeimage{signature-types}{2.5cm}
\caption{Partial type hierarchy for the Signature type system, showing
  string representations of a Java type.}
\label{fig:signature-hierarchy}
\end{figure}

\urldef{\jlsintersectiontypesurl}{\url}{http://java.sun.com/docs/books/jls/third_edition/html/typesValues.html#4.9}
\urldef{\jlsfullyqualifiednameurl}{\url}{http://java.sun.com/docs/books/jls/third_edition/html/names.html#6.7}
\urldef{\jlsbinarynameurl}{\url}{http://java.sun.com/docs/books/jls/third_edition/html/binaryComp.html#13.1}
\urldef{\jvmsfullyqualifiednameurl}{\url}{http://java.sun.com/docs/books/jvms/second_edition/html/Concepts.doc.html#20207}
\urldef{\jvmsfielddescriptorurl}{\url}{http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html#14152}
\urldef{\jvmsinternalformurl}{\url}{http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html#14757}
\urldef{\jvmsmethoddescriptorurl}{\url}{http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html#7035}

\begin{description}

\item[\code{@\refclass{signature/quals}{FullyQualifiedName}}]
  A \emph{fully qualified name} (\ahref{\jlsfullyqualifiednameurl}{JLS \S
    6.7} and \ahref{\jvmsfullyqualifiednameurl}{JVMS \S 2.7.5}), such as
  \<package.Outer.Inner>, is used in Java code and in messages to
  the user.

\item[\code{@\refclass{signature/quals}{BinaryName}}]
  A \emph{binary name} (\ahref{\jlsbinarynameurl}{JLS \S 13.1}), such as
  \<package.Outer\$Inner>, is
  the representation of a type in its own \<.class> file.

\item[\code{@\refclass{signature/quals}{FieldDescriptor}}]
  A \emph{field descriptor} (\ahref{\jvmsfielddescriptorurl}{JVMS \S 4.3.2}), such as
  \<Lpackage/Outer\$Inner;>, is used in a \<.class> file's constant pool,
  for example to refer to other types; it abbreviates primitives and
  arrays, and uses internal form (\ahref{\jvmsinternalformurl}{JVMS \S 4.2}) for class names.

\item[\code{@\refclass{signature/quals}{SourceName}}]
  A source name is a string that is a valid fully qualified name \emph{and}
  a valid binary name.  A programmer should never use this --- you should
  know how you intend to use a given variable.  The checker infers it for
  literal strings such as \<"package.MyClass"> that are valid in both
  formats, and you might occasionally see it in an error message.

\end{description}

Java also defines other string formats for a type: simple
names (JLS \S 6.2), qualified names (JLS \S 6.2), and canonical
names (JLS \S 6.7).  The Signature Checker does not include annotations
for these.


Java defines one format for the string representation of a method signature:

\begin{description}

\item[\code{@\refclass{signature/quals}{MethodDescriptor}}]
  A \emph{method descriptor} (\ahref{\jvmsmethoddescriptorurl}{JVMS \S
    4.3.3}) identifies a method's signature (its parameter and return
  types), just as a field descriptor identifies a 
  type.   The method descriptor for the method
\begin{Verbatim}
    Object mymethod(int i, double d, Thread t)
\end{Verbatim}
\noindent is
\begin{Verbatim}
    (IDLjava/lang/Thread;)Ljava/lang/Object;
\end{Verbatim}

\end{description}


\section{What the Signature Checker checks\label{signature-checks}}

Certain methods in the JDK, such as \<Class.forName>, are annotated
indicating the type they require.  The Signature Checker ensures that
clients call them with the proper arguments.  The Signature Checker does
not reason about string operations such as concatenation, substring,
parsing, etc.

To run the Signature Checker, supply the \code{-processor
  checkers.signature.SignatureChecker} command-line option to javac.


% LocalWords:  Regex regex quals FullyQualifiedName BinaryName FieldDescriptor
% LocalWords:  Lpackage SourceName MyClass MethodDescriptor forName substring
